<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ultimate Workflow — Second Brain (Pro)</title>
  <meta name="theme-color" content="#4c6bff"/>
  <style>
    :root{--bg:#f3f6fb;--card:#ffffff;--muted:#6b7280;--text:#0f1724;--accent:#4c6bff;--success:#00b37e;--danger:#e24b4b}
    body{margin:0;font-family:Inter,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text)}
    .app{max-width:1200px;margin:28px auto;padding:20px}
    .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
    h1{margin:0;font-size:20px}

    .layout{display:grid;grid-template-columns:1fr 420px;gap:18px}
    .panel{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 8px 24px rgba(15,23,36,0.06)}

    .workflow-header{display:flex;gap:12px;align-items:center}
    .day-toggle{display:flex;gap:8px}
    .btn{border:0;padding:10px 14px;border-radius:10px;background:var(--accent);color:#fff;cursor:pointer}
    .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(76,107,255,0.12)}

    .tasks{margin-top:14px}
    .task-row{display:flex;justify-content:space-between;align-items:center;padding:12px;border-radius:10px;border:1px solid #eef2ff;margin-bottom:10px}
    .task-left{display:flex;align-items:center;gap:12px}
    .task-title{font-weight:600}
    .task-min{color:var(--muted);font-size:13px}

    .progress-wrap{margin-top:12px}
    .progress-bar{height:12px;background:#e6ecff;border-radius:8px;overflow:hidden}
    .progress-fill{height:100%;width:0;background:linear-gradient(90deg,var(--accent),#6aa0ff)}
    .progress-meta{display:flex;justify-content:space-between;margin-top:6px;color:var(--muted);font-size:13px}

    .secondbrain{display:flex;flex-direction:column;gap:12px}
    .sb-section{padding:12px;border-radius:10px;border:1px solid #eef2ff}
    .sb-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .small{font-size:13px;color:var(--muted)}

    .watch-list{display:flex;flex-direction:column;gap:8px;max-height:220px;overflow:auto;padding-right:6px}
    .watch-item{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;background:#fbfbff}
    .watch-item a{color:var(--accent);text-decoration:none}

    .topic-list{display:flex;flex-direction:column;gap:10px;max-height:340px;overflow:auto}
    .topic{border-radius:10px;padding:10px;background:#fff;border:1px solid #f1f5f9}
    .topic h4{margin:0 0 6px 0}
    .topic-meta{display:flex;gap:8px;align-items:center;color:var(--muted);font-size:13px}
    .notes{margin-top:8px;background:#fafcff;padding:8px;border-radius:8px;border:1px dashed #eef1ff}
    textarea{width:100%;min-height:80px;padding:10px;border-radius:8px;border:1px solid #e6eefc}

    .row{display:flex;gap:8px}
    .input{padding:10px;border-radius:8px;border:1px solid #e6eefc;flex:1}
    .smallmuted{color:var(--muted);font-size:13px}
    .controls{display:flex;gap:8px;align-items:center}

    .kbd{background:#f1f5ff;padding:4px 8px;border-radius:6px;border:1px solid #e6eeff;font-size:13px}

    @media (max-width:1100px){.layout{grid-template-columns:1fr;}.secondbrain{order:2}}
  </style>
</head>
<body>
  <div class="app">
    <div class="topbar">
      <h1>Ultimate Workflow — Second Brain (Pro)</h1>
      <div class="controls">
        <button class="btn ghost" onclick="exportData()">Export JSON</button>
        <button class="btn ghost" onclick="importPrompt()">Import</button>
        <button class="btn" onclick="toggleDark()">Toggle Dark</button>
      </div>
    </div>

    <div class="layout">
      <div>
        <div class="panel">
          <div class="workflow-header">
            <div>
              <div class="day-toggle">
                <button class="btn" onclick="setDay('A')">Day A</button>
                <button class="btn ghost" onclick="setDay('B')">Day B</button>
              </div>
              <div class="smallmuted" style="margin-top:8px">Your daily schedule — complete tasks, track progress, use timers</div>
            </div>
            <div class="controls">
              <input id="globalSearch" class="input" placeholder="Quick search (press /)" oninput="globalSearch()">
            </div>
          </div>

          <div class="tasks" id="tasksContainer"></div>

          <div class="progress-wrap">
            <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
            <div class="progress-meta"><span id="progressText">0% complete</span><span id="progressCount">0 / 0</span></div>
          </div>
        </div>

        <div class="panel" style="margin-top:14px">
          <h3 style="margin-top:0">Courses & Links</h3>
          <div id="coursesSection"></div>
          <div style="margin-top:10px" class="row">
            <input id="courseName" class="input" placeholder="Course title">
            <input id="courseLink" class="input" placeholder="URL">
            <button class="btn" onclick="addCourseFromInput()">Add</button>
          </div>
        </div>
      </div>

      <aside class="secondbrain">

        <div class="panel sb-section">
          <div class="sb-header"><strong>Watch Later — YouTube</strong><span class="small">save links to watch</span></div>
          <div class="row" style="margin-bottom:8px">
            <input id="wlTitle" class="input" placeholder="Short title (eg: JS closure)">
            <input id="wlUrl" class="input" placeholder="YouTube URL">
            <button class="btn" onclick="addWatch()">Save</button>
          </div>
          <div class="watch-list" id="watchList"></div>
        </div>

        <div class="panel sb-section">
          <div class="sb-header"><strong>Learning Hub</strong><span class="small">topics you are learning / want to learn</span></div>

          <div style="display:flex;gap:8px;margin-bottom:10px">
            <input id="topicTitle" class="input" placeholder="Topic name (eg: Neural Nets)">
            <select id="topicStatus" class="input" style="max-width:160px">
              <option value="backlog">Backlog</option>
              <option value="learning">Learning</option>
              <option value="mastered">Mastered</option>
            </select>
            <button class="btn" onclick="addTopic()">Add Topic</button>
          </div>

          <div class="topic-list" id="topicList"></div>

          <div style="margin-top:10px" class="smallmuted">Tip: Use topics as folders — each topic saves notes, links, progress, and tags.</div>
        </div>

        <div class="panel sb-section">
          <div class="sb-header"><strong>Quick Notes</strong><span class="small">fast capture — markdown supported</span></div>
          <textarea id="quickNote" placeholder="Capture an idea, paste a link, or jot a reminder"></textarea>
          <div style="display:flex;gap:8px;margin-top:8px">
            <input id="noteTag" class="input" placeholder="tag (eg: idea, research)">
            <button class="btn" onclick="saveQuickNote()">Save</button>
          </div>
          <div id="quickNotesList" style="margin-top:10px;max-height:160px;overflow:auto"></div>
          <div style="margin-top:8px" class="smallmuted">Keyboard: '/' focus search — 'n' new note</div>
        </div>

      </aside>
    </div>
  </div>

  <script>
    // -- State (persisted) --
    const state = {
      dayA: [
        {name:'Reading',minutes:60,done:false,notes:''},
        {name:'Course Study',minutes:60,done:false,notes:''},
        {name:'News Study',minutes:30,done:false,notes:''},
        {name:'Bible Reading',minutes:45,done:false,notes:''}
      ],
      dayB: [
        {name:'Reading',minutes:60,done:false,notes:''},
        {name:'GED Study',minutes:60,done:false,notes:''},
        {name:'Course Study',minutes:60,done:false,notes:''},
        {name:'News Study',minutes:30,done:false,notes:''},
        {name:'Bible Reading',minutes:30,done:false,notes:''}
      ],
      courses: JSON.parse(localStorage.getItem('uw_courses')||'[]'),
      watchLater: JSON.parse(localStorage.getItem('uw_watch')||'[]'),
      topics: JSON.parse(localStorage.getItem('uw_topics')||'[]'),
      quickNotes: JSON.parse(localStorage.getItem('uw_qnotes')||'[]'),
      currentDay: localStorage.getItem('uw_day')||'A'
    };

    function saveAll(){
      localStorage.setItem('uw_courses',JSON.stringify(state.courses));
      localStorage.setItem('uw_watch',JSON.stringify(state.watchLater));
      localStorage.setItem('uw_topics',JSON.stringify(state.topics));
      localStorage.setItem('uw_qnotes',JSON.stringify(state.quickNotes));
      localStorage.setItem('uw_day',state.currentDay);
    }

    // -- Render & UI --
    function setDay(d){ state.currentDay=d; saveAll(); renderCurrent(); }

    function renderCurrent(){
      renderTasks(); renderCourses(); renderWatch(); renderTopics(); renderQuickNotes();
    }

    function renderTasks(){
      const container=document.getElementById('tasksContainer'); const search=document.getElementById('globalSearch').value.toLowerCase();
      const tasks = state.currentDay==='A'?state.dayA:state.dayB; container.innerHTML='';
      tasks.forEach((t,i)=>{
        if(search && !(`${t.name} ${t.notes}`.toLowerCase().includes(search))) return;
        const row=document.createElement('div'); row.className='task-row';
        row.innerHTML = `<div style='display:flex;gap:12px;align-items:center'><input type='checkbox' ${t.done? 'checked':''} onchange='toggleDone(${i})'>
          <div><div class='task-title'>${escapeHtml(t.name)}</div><div class='task-min'>${t.minutes} min</div></div></div>
          <div><button class='btn ghost' onclick='startTimer(${t.minutes},"${escapeHtml(t.name)}")'>Timer</button>
          <button class='btn ghost' onclick='editTask(${i})'>Edit</button></div>`;
        container.appendChild(row);
      }); updateProgress();
    }

    function toggleDone(i){ const tasks = state.currentDay==='A'?state.dayA:state.dayB; tasks[i].done=!tasks[i].done; saveAll(); updateProgress(); }

    function updateProgress(){ const tasks = state.currentDay==='A'?state.dayA:state.dayB; const total=tasks.length; const done=tasks.filter(t=>t.done).length; const pct = total? Math.round((done/total)*100):0; document.getElementById('progressFill').style.width=pct+'%'; document.getElementById('progressText').innerText=pct+'% complete'; document.getElementById('progressCount').innerText=`${done} / ${total}`; }

    // -- Courses --
    function renderCourses(){ const el=document.getElementById('coursesSection'); el.innerHTML=''; state.courses.forEach((c,i)=>{ const row=document.createElement('div'); row.style.display='flex'; row.style.justifyContent='space-between'; row.style.alignItems='center'; row.style.marginBottom='8px'; row.innerHTML = `<div style='flex:1'><a href='${c.url}' target='_blank'>${escapeHtml(c.name)}</a><div class='smallmuted'>${escapeHtml(c.url)}</div></div><div><button class='btn ghost' onclick='removeCourse(${i})'>Remove</button></div>`; el.appendChild(row); }); }
    function addCourseFromInput(){ const n=document.getElementById('courseName').value.trim(); const u=document.getElementById('courseLink').value.trim(); if(!n||!u) return alert('fill both'); state.courses.push({name:n,url:u}); document.getElementById('courseName').value=''; document.getElementById('courseLink').value=''; saveAll(); renderCourses(); }
    function removeCourse(i){ state.courses.splice(i,1); saveAll(); renderCourses(); }

    // -- Watch Later --
    function renderWatch(){ const list=document.getElementById('watchList'); list.innerHTML=''; state.watchLater.forEach((w,i)=>{ const item=document.createElement('div'); item.className='watch-item'; item.innerHTML = `<div><strong>${escapeHtml(w.title||w.url)}</strong><div class='smallmuted'>${escapeHtml(w.url)}</div></div><div style='display:flex;gap:6px'><button class='btn ghost' onclick='openWatch(${i})'>Open</button><button class='btn ghost' onclick='markWatched(${i})'>Mark</button><button class='btn' onclick='removeWatch(${i})'>Del</button></div>`; list.appendChild(item); }); }
    function addWatch(){ const t=document.getElementById('wlTitle').value.trim(); const u=document.getElementById('wlUrl').value.trim(); if(!u) return alert('need url'); state.watchLater.unshift({title:t,url:u,watched:false}); saveAll(); document.getElementById('wlTitle').value=''; document.getElementById('wlUrl').value=''; renderWatch(); }
    function openWatch(i){ window.open(state.watchLater[i].url,'_blank'); }
    function markWatched(i){ state.watchLater[i].watched = !state.watchLater[i].watched; saveAll(); renderWatch(); }
    function removeWatch(i){ state.watchLater.splice(i,1); saveAll(); renderWatch(); }

    // -- Topics (Second Brain) --
    function renderTopics(){ const list=document.getElementById('topicList'); list.innerHTML=''; state.topics.forEach((t,i)=>{ const node=document.createElement('div'); node.className='topic'; node.innerHTML=`<div style='display:flex;justify-content:space-between;align-items:center'><h4>${escapeHtml(t.title)}</h4><div class='topic-meta'><span>${escapeHtml(t.status)}</span><button class='btn ghost' onclick='openTopic(${i})'>Open</button><button class='btn' onclick='removeTopic(${i})'>Del</button></div></div><div class='smallmuted'>Tags: ${t.tags? t.tags.join(', '): '—'}</div><div class='notes'>${renderMarkdown(t.notes||'')}</div>`; list.appendChild(node); }); }
    function addTopic(){ const title=document.getElementById('topicTitle').value.trim(); const status=document.getElementById('topicStatus').value; if(!title) return alert('title'); state.topics.unshift({title,status,tags:[],notes:''}); document.getElementById('topicTitle').value=''; saveAll(); renderTopics(); }
    function removeTopic(i){ if(!confirm('Delete topic?')) return; state.topics.splice(i,1); saveAll(); renderTopics(); }
    function openTopic(i){ const t=state.topics[i]; const newTitle = prompt('Title',t.title); if(newTitle!==null) t.title=newTitle; const newStatus = prompt('Status (backlog/learning/mastered)',t.status); if(newStatus) t.status=newStatus; const newTags = prompt('Tags (comma separated)',t.tags.join(', ')); if(newTags!==null) t.tags = newTags.split(',').map(s=>s.trim()).filter(Boolean); const newNotes = prompt('Notes (supports markdown)', t.notes || ''); if(newNotes!==null) t.notes=newNotes; saveAll(); renderTopics(); }

    // -- Quick Notes (markdown supported) --
    function renderQuickNotes(){ const el=document.getElementById('quickNotesList'); el.innerHTML=''; state.quickNotes.forEach((n,i)=>{ const d=document.createElement('div'); d.style.padding='8px'; d.style.borderBottom='1px solid #f1f5f9'; d.innerHTML=`<div style='display:flex;justify-content:space-between'><div><strong>${n.tag? '['+escapeHtml(n.tag)+'] ' : ''}</strong>${renderMarkdown(n.text.substring(0,500))}</div><div><button class='btn ghost' onclick='openQuick(${i})'>Open</button><button class='btn' onclick='delQuick(${i})'>Del</button></div></div>`; el.appendChild(d); }); }
    function saveQuickNote(){ const t=document.getElementById('quickNote').value.trim(); const tag=document.getElementById('noteTag').value.trim(); if(!t) return; state.quickNotes.unshift({text:t,tag:tag||null,created:Date.now()}); document.getElementById('quickNote').value=''; document.getElementById('noteTag').value=''; saveAll(); renderQuickNotes(); }
    function openQuick(i){ const n=state.quickNotes[i]; const newText = prompt('Edit note (markdown supported)', n.text); if(newText!==null){ n.text=newText; saveAll(); renderQuickNotes(); } }
    function delQuick(i){ state.quickNotes.splice(i,1); saveAll(); renderQuickNotes(); }

    // -- Timers (simple) --
    let timerInterval=null; function startTimer(min,label){ clearInterval(timerInterval); const end = Date.now() + min*60*1000; let popup = document.getElementById('timerPopup'); if(!popup){ popup = document.createElement('div'); popup.id='timerPopup'; popup.style= 'position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:var(--card);padding:18px;border-radius:12px;box-shadow:0 16px 40px rgba(12,18,36,0.2);z-index:9999'; popup.innerHTML = `<h3>Timer</h3><h1>00:00</h1><div style='margin-top:10px;display:flex;gap:8px'><button class='btn' onclick='closeTimer()'>Close</button></div>`; document.body.appendChild(popup); }
      popup.style.display='block'; popup.querySelector('h3').innerText = label;
      function tick(){ const left = Math.max(0, end - Date.now()); const m = Math.floor(left/60000); const s = Math.floor((left%60000)/1000); popup.querySelector('h1').innerText = `${m}:${String(s).padStart(2,'0')}`; if(left<=0){ clearInterval(timerInterval); popup.querySelector('h1').innerText='Done'; navigator.vibrate && navigator.vibrate(200); } }
      tick(); timerInterval=setInterval(tick,1000);
    }
    function closeTimer(){ const popup=document.getElementById('timerPopup'); if(popup) popup.style.display='none'; clearInterval(timerInterval); }

    // -- Export / Import --
    function exportData(){ const data = JSON.stringify(state); const blob = new Blob([data],{type:'application/json'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='ultimate-workflow-backup.json'; a.click(); URL.revokeObjectURL(url); }
    function importPrompt(){ const json = prompt('Paste exported JSON here'); if(!json) return; try{ const obj = JSON.parse(json); if(obj.topics && obj.watchLater){ Object.assign(state,obj); saveAll(); renderCurrent(); alert('Imported'); } }catch(e){alert('Invalid JSON') } }

    // -- Global Search across everything --
    function globalSearch(){ const q=document.getElementById('globalSearch').value.trim().toLowerCase(); if(!q){ renderCurrent(); return; }
      const tasks = state.currentDay==='A'?state.dayA:state.dayB; const tMatches = tasks.filter(t=>`${t.name} ${t.notes||''}`.toLowerCase().includes(q));
      const el=document.getElementById('tasksContainer'); el.innerHTML=''; tMatches.forEach((t,i)=>{ const row=document.createElement('div'); row.className='task-row'; row.innerHTML=`<div style='display:flex;gap:12px;align-items:center'><input type='checkbox' ${t.done? 'checked':''} onchange='toggleDone(${i})'><div><div class='task-title'>${escapeHtml(t.name)}</div><div class='task-min'>${t.minutes} min</div></div></div><div></div>`; el.appendChild(row); });
      highlightMatches(q);
    }
    function highlightMatches(q){ document.getElementById('topicList').querySelectorAll('.topic').forEach(node=>{ node.style.display = node.innerText.toLowerCase().includes(q)? 'block' : 'none'; });
      document.getElementById('watchList').querySelectorAll('.watch-item').forEach(node=>{ node.style.display = node.innerText.toLowerCase().includes(q)? 'flex' : 'none'; });
      document.getElementById('coursesSection').querySelectorAll('div').forEach(node=>{ node.style.display = node.innerText.toLowerCase().includes(q)? 'flex' : 'none'; });
      document.getElementById('quickNotesList').querySelectorAll('div').forEach(node=>{ node.style.display = node.innerText.toLowerCase().includes(q)? 'block' : 'none'; }); }

    // -- Utilities --
    function escapeHtml(str){ return String(str||'').replace(/[&<>\"]/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[c])); }
    function renderMarkdown(text){ if(!text) return '<em>No content</em>'; let out = escapeHtml(text); out = out.replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>'); out = out.replace(/\*(.*?)\*/g,'<em>$1</em>'); out = out.replace(/`(.*?)`/g,'<code>$1</code>'); out = out.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank">$1</a>'); return out; }

    // -- Keyboard shortucts --
    document.addEventListener('keydown',(e)=>{ if(e.key === '/') { e.preventDefault(); document.getElementById('globalSearch').focus(); } if(e.key === 'n') { document.getElementById('quickNote').focus(); } });

    // -- Dark toggle --
    function toggleDark(){ document.body.classList.toggle('dark-mode'); }

    // -- Init & register simple offline service worker (PWA-lite) --
    renderCurrent();
    if('serviceWorker' in navigator){ try{ const swCode = `self.addEventListener('install', e => { self.skipWaiting(); }); self.addEventListener('fetch', e => { e.respondWith(fetch(e.request).catch(()=>caches.match(e.request))); });`; const blob = new Blob([swCode],{type:'application/javascript'}); const swUrl = URL.createObjectURL(blob); navigator.serviceWorker.register(swUrl).catch(()=>{}); }catch(e){} }

    window._uw={state,saveAll};
  </script>
</body>
</html>
